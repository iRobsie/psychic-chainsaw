<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><title>TinyCraft — controls unflipped + tree spawn fix</title><style>html,body{height:100%;margin:0;background:#8ec5ff;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}#cv{width:100%;height:100%;display:block;background:#87b6ff;cursor:crosshair}.hud{position:fixed;inset:0;pointer-events:none;color:#fff;text-shadow:0 1px 2px #000c;font-size:14px;display:flex;flex-direction:column;justify-content:space-between}.chip{background:#0007;border:1px solid #fff3;border-radius:8px;padding:6px 10px;backdrop-filter:blur(4px)}.top{padding:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}.bottom{padding:8px}.hot{display:flex;gap:6px}.slot{width:28px;height:28px;border:2px solid #fff6;border-radius:6px;background:#0004;display:grid;place-items:center}.sel{border-color:#fff;box-shadow:0 0 8px #fff}.sw{width:16px;height:16px;border-radius:3px;border:1px solid #fff9}.xh{position:absolute;left:50%;top:50%;width:18px;height:18px;margin:-9px 0 0 -9px}.xh:before,.xh:after{content:"";position:absolute;background:#fff;opacity:.9;box-shadow:0 0 2px #000a}.xh:before{left:8px;top:0;width:2px;height:18px}.xh:after{top:8px;left:0;width:18px;height:2px}.mini{position:fixed;right:10px;bottom:10px;width:140px;height:140px;border:1px solid #fff7;border-radius:6px;background:#0005;backdrop-filter:blur(2px)}.mini canvas{width:100%;height:100%;display:block}</style><canvas id=cv></canvas><div class=hud><div class=top><div class=chip id=fps>FPS 0</div><div class=chip id=seed>seed</div><div class=chip>Controls fixed: move mouse RIGHT = look RIGHT. A = strafe LEFT, D = strafe RIGHT. Click to aim. If lock blocked: middle‑drag or press L to hover‑aim. WASD, Space, Shift. 1–8 select. LMB break, RMB place. R reseed.</div></div><div class=bottom><div class=chip>Hotbar: <span id=hot class=hot></span></div></div><div class=mini><canvas id=mm width=64 height=64></canvas></div><div class=xh></div><script>(()=>{const cv=document.getElementById('cv'),gl=cv.getContext('webgl',{antialias:true});if(!gl){alert('WebGL');return}const $=x=>document.getElementById(x),HUD={fps:$('fps'),seed:$('seed'),hot:$('hot'),mm:$('mm')};function rsz(){const d=Math.min(devicePixelRatio||1,2);const w=(innerWidth*d)|0,h=(innerHeight*d)|0;if(cv.width!==w||cv.height!==h){cv.width=w;cv.height=h}gl.viewport(0,0,w,h)}addEventListener('resize',rsz,{passive:1});rsz();/* ===== config ===== */const W={Y:128,CH:16};let CH_R=6;const EYE=1.62,SENS=.0022,GRV=22,SPD=5,SPD2=9,JMP=7.5,RAY=12;let fogD=230,fogC=[.6,.8,1];/* ===== blocks ===== */const I={AIR:0,GRS:1,DIR:2,STO:3,SAN:4,WAT:5,LOG:6,LEA:7,PLK:8,ORE:9};const IT=[{id:I.AIR,n:'Air',s:0,c:[0,0,0]},{id:I.GRS,n:'Grass',s:1,c:[.32,.84,.32]},{id:I.DIR,n:'Dirt',s:1,c:[.55,.35,.22]},{id:I.STO,n:'Stone',s:1,c:[.65,.65,.69]},{id:I.SAN,n:'Sand',s:1,c:[.92,.86,.58]},{id:I.WAT,n:'Water',s:0,c:[.22,.52,.96]},{id:I.LOG,n:'Log',s:1,c:[.58,.42,.28]},{id:I.LEA,n:'Leaves',s:0,c:[.2,.62,.26]},{id:I.PLK,n:'Planks',s:1,c:[.8,.65,.45]},{id:I.ORE,n:'Ore',s:1,c:[.52,.52,.57]}];const NAME=id=>IT[id]?.n||'?';const COL=id=>IT[id]?.c||[1,0,1];const SOL=id=>IT[id]?.s!==0;const HOT=[I.GRS,I.DIR,I.SAN,I.STO,I.PLK,I.LOG,I.LEA,I.WAT];let sel=3;/* ===== rng/seed ===== */function h32(s){let h=2166136261>>>0;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=Math.imul(h,16777619)}return h>>>0}function m32(a){return function(){a|=0;a=a+0x6D2B79F5|0;let t=Math.imul(a^a>>>15,1|a);t^=t+Math.imul(t^t>>>7,61|t);return((t^t>>>14)>>>0)/4294967296}}let seed=(localStorage.tc_seed)||('s'+Math.random().toString(36).slice(2));let RNG=m32(h32(seed));HUD.seed.textContent='seed '+seed;/* ===== world (procedural, chunked) ===== */const edits=new Map();const CH=new Map();const k3=(x,y,z)=>x+','+y+','+z;const inW=(x,y,z)=>y>=0&&y<W.Y;const n2=(x,z)=>Math.sin(x*.09)+Math.cos(z*.08)+Math.sin((x+z)*.05)*.6;const sea=()=>Math.floor(W.Y*.19);const hAt=(x,z)=>{const vr=Math.floor(W.Y*.08);return Math.max(2,Math.min(W.Y-6,sea()+Math.floor(n2(x,z)*vr)))};function baseId(x,y,z){const h=hAt(x,z),S=sea();if(y>h){if(y<S-1)return I.WAT;return I.AIR}if(y===h)return h<S+2?I.SAN:I.GRS; if(y>=h-3)return I.DIR; return I.STO}function veins(x,y,z){if(y>W.Y*.5)return 0;const r=(Math.sin(x*11.4+z*7.1+y*3.7)*.5+.5);return r>.945}function decoId(x,y,z){const H=hAt(x,z),S=sea(); // prevent underwater/beach trees
if(H<=S+1) return null; // only above waterline
const base=baseId(x,H,z); if(base!==I.GRS) return null; // only grow on grass
const r=((h32(seed+':'+(x>>3)+','+(z>>3))>>>0)%997)/997; if(y===H+1&&r<.045&&H+7<W.Y)return I.LOG; if(y>=H+3&&y<=H+6&&r<.045)return I.LEA; return null}function getId(x,y,z){if(!inW(x,y,z))return I.AIR;const key=((x|0)<<20)^(y<<10)^(z|0);if(edits.has(key))return edits.get(key);let id=baseId(x,y,z);if(id===I.STO&&veins(x,y,z))id=I.ORE;const d=decoId(x,y,z);if(d!=null)id=d;return id}function setId(x,y,z,id){const key=((x|0)<<20)^(y<<10)^(z|0);edits.set(key,id);touchNeighbors(x,y,z)}/* ===== meshing ===== */const DIR=[{n:[1,0,0],f:[[1,0,0],[1,1,0],[1,1,1],[1,0,1]]},{n:[-1,0,0],f:[[0,0,1],[0,1,1],[0,1,0],[0,0,0]]},{n:[0,1,0],f:[[0,1,1],[1,1,1],[1,1,0],[0,1,0]]},{n:[0,-1,0],f:[[0,0,0],[1,0,0],[1,0,1],[0,0,1]]},{n:[0,0,1],f:[[0,0,1],[1,0,1],[1,1,1],[0,1,1]]},{n:[0,0,-1],f:[[0,1,0],[1,1,0],[1,0,0],[0,0,0]]}];function buildChunk(cx,cy,cz){const sv=[],wv=[];const sx=cx*W.CH,sy=cy*W.CH,sz=cz*W.CH;for(let y=sy;y<sy+W.CH;y++)for(let z=sz;z<sz+W.CH;z++)for(let x=sx;x<sx+W.CH;x++){const id=getId(x,y,z);if(id===I.AIR)continue;const base=COL(id);for(const d of DIR){const nx=x+d.n[0],ny=y+d.n[1],nz=z+d.n[2];const nId=getId(nx,ny,nz);let draw=false;if(id===I.WAT){draw=(nId!==I.WAT)}else{draw=(!SOL(nId))}if(!draw)continue;const sh=.9+(d.n[1]>.5?.12:d.n[1]<-.5?-0.28:0);const c=[base[0]*sh,base[1]*sh,base[2]*sh];const arr=(id===I.WAT)?wv:sv;const topWave=(id===I.WAT && d.n[1]>0)?1:0;for(const i of[0,1,2,0,2,3]){const p=d.f[i];arr.push(x+p[0],y+p[1],z+p[2],...d.n,...c,topWave)}}}const sb=new Float32Array(sv),wb=new Float32Array(wv);const sbo=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,sbo);gl.bufferData(gl.ARRAY_BUFFER,sb,gl.STATIC_DRAW);const wbo=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,wbo);gl.bufferData(gl.ARRAY_BUFFER,wb,gl.STATIC_DRAW);return{sb:sbo,sc:sb.length/10,wb:wbo,wc:wb.length/10}}function touchNeighbors(x,y,z){const cx=Math.floor(x/W.CH),cy=Math.floor(y/W.CH),cz=Math.floor(z/W.CH);for(let dy=-1;dy<=1;dy++)for(let dz=-1;dz<=1;dz++)for(let dx=-1;dx<=1;dx++){const k=k3(cx+dx,cy+dy,cz+dz),c=CH.get(k);if(c)c.d=1}}function ensureChunks(px,pz){const cx=Math.floor(px/W.CH),cz=Math.floor(pz/W.CH);for(let dz=-CH_R;dz<=CH_R;dz++)for(let dx=-CH_R;dx<=CH_R;dx++){for(let cy=0;cy<Math.ceil(W.Y/W.CH);cy++){const k=k3(cx+dx,cy,cz+dz);if(!CH.has(k))CH.set(k,{p:[cx+dx,cy,cz+dz],d:1})}}}let budget=10;function rebuildSome(){let b=0;for(const [k,c]of CH){if(c.d){const m=buildChunk(c.p[0],c.p[1],c.p[2]);Object.assign(c,m);c.d=0;b++;if(b>=budget)break}}}function bootstrapBuild(rad=3){const cx=Math.floor(pos[0]/W.CH),cz=Math.floor(pos[2]/W.CH);for(let cy=0;cy<Math.ceil(W.Y/W.CH);cy++)for(let dz=-rad;dz<=rad;dz++)for(let dx=-rad;dx<=rad;dx++){const k=k3(cx+dx,cy,cz+dz);const m=buildChunk(cx+dx,cy,cz+dz);CH.set(k,Object.assign({p:[cx+dx,cy,cz+dz],d:0},m))}}/* ===== shaders ===== */function sh(t,s){const o=gl.createShader(t);gl.shaderSource(o,s);gl.compileShader(o);if(!gl.getShaderParameter(o,gl.COMPILE_STATUS))throw gl.getShaderInfoLog(o);return o}const VS_SRC=`attribute vec3 aP,aN,aC;attribute float aT;uniform mat4 uP,uV;uniform vec3 uL;uniform float uTime;varying vec3 vC;varying float vZ;varying float vT;void main(){vec3 p=aP; if(aT>0.5){p.y+=sin((aP.x+aP.z)*0.18+uTime*1.6)*0.06;} vec4 e=uV*vec4(p,1.);gl_Position=uP*e;float d=max(dot(normalize(aN),normalize(uL)),0.)*.6+.4;vC=aC*d;vZ=-e.z;vT=aT;}`;const FS_SRC=`precision mediump float;varying vec3 vC;varying float vZ;varying float vT;uniform vec3 uFogC;uniform float uFogD;uniform float uUW;void main(){float f=clamp((uFogD - vZ)/uFogD,0.,1.);vec3 col=vC; if(vT>0.5){col=mix(vec3(.18,.46,.95),col,.35);} if(uUW>0.5){col=mix(vec3(.35,.6,.9),col,.65);} gl_FragColor=vec4(mix(uFogC,col,f), (vT>0.5? .55:1.));}`;const PG=gl.createProgram();gl.attachShader(PG,sh(gl.VERTEX_SHADER,VS_SRC));gl.attachShader(PG,sh(gl.FRAGMENT_SHADER,FS_SRC));gl.linkProgram(PG);gl.useProgram(PG);const L={p:gl.getAttribLocation(PG,'aP'),n:gl.getAttribLocation(PG,'aN'),c:gl.getAttribLocation(PG,'aC'),t:gl.getAttribLocation(PG,'aT'),P:gl.getUniformLocation(PG,'uP'),V:gl.getUniformLocation(PG,'uV'),L:gl.getUniformLocation(PG,'uL'),FC:gl.getUniformLocation(PG,'uFogC'),FD:gl.getUniformLocation(PG,'uFogD'),TIME:gl.getUniformLocation(PG,'uTime'),UW:gl.getUniformLocation(PG,'uUW')};gl.enable(gl.DEPTH_TEST);gl.enable(gl.BLEND);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);function bind(buf){gl.bindBuffer(gl.ARRAY_BUFFER,buf);gl.enableVertexAttribArray(L.p);gl.enableVertexAttribArray(L.n);gl.enableVertexAttribArray(L.c);gl.enableVertexAttribArray(L.t);gl.vertexAttribPointer(L.p,3,gl.FLOAT,0,40,0);gl.vertexAttribPointer(L.n,3,gl.FLOAT,0,40,12);gl.vertexAttribPointer(L.c,3,gl.FLOAT,0,40,24);gl.vertexAttribPointer(L.t,1,gl.FLOAT,0,40,36)}/* ===== math ===== */const clamp=(v,a,b)=>v<a?a:v>b?b:v;function persp(fovy,asp,nr,fr){const f=1/Math.tan(fovy/2),nf=1/(nr-fr);return new Float32Array([f/asp,0,0,0,0,f,0,0,0,0,(fr+nr)*nf,-1,0,0,(2*fr*nr)*nf,0])}function look(e,c,u){const f0=[c[0]-e[0],c[1]-e[1],c[2]-e[2]],fl=Math.hypot(...f0)||1;const f=[f0[0]/fl,f0[1]/fl,f0[2]/fl];const sx=f[1]*u[2]-f[2]*u[1],sy=f[2]*u[0]-f[0]*u[2],sz=f[0]*u[1]-f[1]*u[0],sl=Math.hypot(sx,sy,sz)||1,s=[sx/sl,sy/sl,sz/sl],ux=s[1]*f[2]-s[2]*f[1],uy=s[2]*f[0]-s[0]*f[2],uz=s[0]*f[1]-s[1]*f[0];return new Float32Array([s[0],ux,-f[0],0,s[1],uy,-f[1],0,s[2],uz,-f[2],0,-(s[0]*e[0]+s[1]*e[1]+s[2]*e[2]),-(ux*e[0]+uy*e[1]+uz*e[2]),f[0]*e[0]+f[1]*e[1]+f[2]*e[2],1])}/* ===== player/spawn ===== */let yaw=0,pitch=0,pos=[0,0,0],vel=[0,0,0],ground=0;function freeAbove(x,y,z){const a1=getId(x,y+1,z),a2=getId(x,y+2,z);return (a1!==I.WAT && a2!==I.WAT && !SOL(a1) && !SOL(a2))}function topDry(x,z){for(let y=W.Y-4;y>=2;y--)if(SOL(getId(x,y,z))&&freeAbove(x,y,z))return y;return null}function findSpawn(){const S=sea();let best=null;const rMax=400;for(let r=2;r<rMax;r+=2){for(let a=0;a<Math.PI*2;a+=Math.PI/12){const x=(Math.cos(a)*r)|0,z=(Math.sin(a)*r)|0;const y=topDry(x,z);if(y!=null){const h=hAt(x,z);if(h>S+1){best=[x,y,z];return best}best=[x,y,z]}}}return best}function respawn(){const s=findSpawn();if(s){pos=[s[0]+.5,s[1]+.05,s[2]+.5];vel=[0,0,0];ensureChunks(pos[0],pos[2]);bootstrapBuild(3)}else{pos=[0,sea()+6,0];vel=[0,0,0];ensureChunks(0,0);bootstrapBuild(3)}}function eye(){return[pos[0],pos[1]+EYE,pos[2]]}function fwd(){return[Math.sin(yaw)*Math.cos(pitch),Math.sin(pitch),Math.cos(yaw)*Math.cos(pitch)]}function flat(){return[Math.sin(yaw),0,Math.cos(yaw)]}function right(){const f=flat();return[f[2],0,-f[0]]}/* ===== input ===== */const k=new Set();addEventListener('keydown',e=>{if(e.repeat)return;k.add(e.code);if(e.code.startsWith('Digit')){const n=+e.code.slice(5);if(n>=1&&n<=HOT.length){sel=n-1;paintHot()}}if(e.code==='KeyL'){hover^=1}if(e.code==='KeyR'){seed='s'+Math.random().toString(36).slice(2);localStorage.tc_seed=seed;RNG=m32(h32(seed));edits.clear();CH.clear();respawn()}});addEventListener('keyup',e=>k.delete(e.code));let hover=1,drag=0,prev=null;cv.onclick=()=>{try{cv.requestPointerLock?.()}catch{}};cv.addEventListener('contextmenu',e=>e.preventDefault());cv.onmousedown=e=>{if(e.button===1){drag=1;prev=null}};addEventListener('mouseup',e=>{if(e.button===1)drag=0});document.addEventListener('pointerlockchange',()=>{if(document.pointerLockElement!==cv){prev=null}});addEventListener('mousemove',e=>{let dx=0,dy=0;if(document.pointerLockElement===cv){dx=e.movementX;dy=-e.movementY}else if(drag||hover){if(prev){dx=e.clientX-prev[0];dy=-(e.clientY-prev[1])}prev=[e.clientX,e.clientY]}/* FIX: make mouse RIGHT look RIGHT */ yaw-=dx*SENS; pitch=clamp(pitch+dy*SENS,-1.4,1.4)});addEventListener('blur',()=>{k.clear();drag=0;prev=null});/* ===== raycast ===== */function rc(o,d,max){let x=Math.floor(o[0]),y=Math.floor(o[1]),z=Math.floor(o[2]);const sx=d[0]>0?1:-1,sy=d[1]>0?1:-1,sz=d[2]>0?1:-1;const tdx=Math.abs(1/(d[0]||1e-9)),tdy=Math.abs(1/(d[1]||1e-9)),tdz=Math.abs(1/(d[2]||1e-9));let tx=(sx>0?(x+1-o[0]):(o[0]-x))*tdx,ty=(sy>0?(y+1-o[1]):(o[1]-y))*tdy,tz=(sz>0?(z+1-o[2]):(o[2]-z))*tdz,t=0,nx=0,ny=0,nz=0;while(t<=max){if(!inW(x,y,z))return null;const id=getId(x,y,z);if(id!==I.AIR) return {x,y,z,n:[-nx,-ny,-nz],id};if(tx<ty){if(tx<tz){x+=sx;t=tx;tx+=tdx;nx=sx;ny=0;nz=0}else{z+=sz;t=tz;tz+=tdz;nx=0;ny=0;nz=sz}} else {if(ty<tz){y+=sy;t=ty;ty+=tdy;nx=0;ny=sy;nz=0}else{z+=sz;t=tz;tz+=tdz;nx=0;ny=0;nz=sz}}}return null}addEventListener('mousedown',e=>{if(e.button!==0&&e.button!==2)return;const h=rc(eye(),fwd(),RAY);if(e.button===0&&h){setId(h.x,h.y,h.z,I.AIR);rebuildAround(h.x,h.y,h.z)}if(e.button===2&&h){const x=h.x+h.n[0],y=h.y+h.n[1],z=h.z+h.n[2];if(!inW(x,y,z))return;const id=HOT[sel];if(id===I.WAT)return; // keep water via gen only
if(!(pos[0]+.3<=x||pos[0]-.3>=x+1||pos[1]+1.8<=y||pos[1]>=y+1||pos[2]+.3<=z||pos[2]-.3>=z+1))return;setId(x,y,z,id);rebuildAround(x,y,z)}});function rebuildAround(x,y,z){const cx=Math.floor(x/W.CH),cy=Math.floor(y/W.CH),cz=Math.floor(z/W.CH);for(let dy=-1;dy<=1;dy++)for(let dz=-1;dz<=1;dz++)for(let dx=-1;dx<=1;dx++){const k=k3(cx+dx,cy+dy,cz+dz),c=CH.get(k);if(c)c.d=1}}/* ===== physics ===== */function axis(a,dt){pos[a]+=vel[a]*dt;const half=.3;const minX=Math.floor(pos[0]-half),maxX=Math.floor(pos[0]+half),minY=Math.floor(pos[1]),maxY=Math.floor(pos[1]+1.8),minZ=Math.floor(pos[2]-half),maxZ=Math.floor(pos[2]+half);for(let y=minY;y<=maxY;y++)for(let z=minZ;z<=maxZ;z++)for(let x=minX;x<=maxX;x++){const id=getId(x,y,z);if(id===I.AIR||id===I.LEA)continue;if(a===0){pos[0]=vel[0]>0?x-half:x+1+half;vel[0]=0}else if(a===1){if(vel[1]>0)pos[1]=y-1.8;else{pos[1]=y+1;ground=1}vel[1]=0}else{pos[2]=vel[2]>0?z-half:z+1+half;vel[2]=0}}}/* ===== UI ===== */function paintHot(){HUD.hot.innerHTML='';HOT.forEach((id,i)=>{const d=document.createElement('div');d.className='slot'+(i===sel?' sel':'');const s=document.createElement('div');s.className='sw';const c=COL(id);s.style.background=`rgb(${(c[0]*255|0)} ${(c[1]*255|0)} ${(c[2]*255|0)})`;d.appendChild(s);HUD.hot.appendChild(d)})}paintHot();/* ===== minimap ===== */const mm=HUD.mm.getContext('2d');function drawMini(){const R=64,px=pos[0],pz=pos[2];const img=mm.createImageData(R,R);for(let dz=0;dz<R;dz++)for(let dx=0;dx<R;dx++){const wx=Math.floor(px-32+dx),wz=Math.floor(pz-32+dz);let c=[0,0,0];for(let y=W.Y-1;y>=0;y--){const id=getId(wx,y,wz);if(id!==I.AIR){c=COL(id);break}}const i=(dz*R+dx)*4;img.data[i]=c[0]*255;img.data[i+1]=c[1]*255;img.data[i+2]=c[2]*255;img.data[i+3]=255}mm.putImageData(img,0,0);mm.strokeStyle='white';mm.strokeRect(0,0,R,R);mm.fillStyle='white';mm.fillRect(R/2-1,R/2-1,2,2)}/* ===== loop ===== */respawn();gl.clearColor(.53,.71,.95,1);let last=performance.now(),acc=0,fc=0;function step(t){const dt=Math.min((t-last)/1000,.05);last=t;fc++;acc+=dt;if(acc>.4){HUD.fps.textContent='FPS '+Math.round(fc/acc)+' | chunks '+CH.size;fc=acc=0}ensureChunks(pos[0],pos[2]);rebuildSome();const asp=cv.width/cv.height,proj=persp(Math.PI/3,asp,.1,600);const e=eye(),dir=fwd(),cen=[e[0]+dir[0],e[1]+dir[1],e[2]+dir[2]],view=look(e,cen,[0,1,0]);const sprint=(k.has('ShiftLeft')||k.has('ShiftRight'));const f=flat(),r=right();let mx=0,mz=0;if(k.has('KeyW')){mx+=f[0];mz+=f[2]}if(k.has('KeyS')){mx-=f[0];mz-=f[2]}if(k.has('KeyA')){mx+=r[0];mz+=r[2]}if(k.has('KeyD')){mx-=r[0];mz-=r[2]}const spd=(sprint?SPD2:SPD);const Lm=Math.hypot(mx,mz);if(Lm>1e-6){mx/=Lm;mz/=Lm;vel[0]=mx*spd;vel[2]=mz*spd}else{vel[0]=0;vel[2]=0}if((k.has('Space')||k.has('KeyX'))&&ground){vel[1]=JMP;ground=0}vel[1]-=GRV*dt;axis(0,dt);axis(1,dt);axis(2,dt);const uw=(getId(e[0]|0,e[1]|0,e[2]|0)===I.WAT);const fog=uw?120:fogD;gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);gl.useProgram(PG);gl.uniformMatrix4fv(L.P,0,proj);gl.uniformMatrix4fv(L.V,0,view);gl.uniform3f(L.L,.6,.7,.2);gl.uniform3f(L.FC,fogC[0],fogC[1],fogC[2]);gl.uniform1f(L.FD,fog);gl.uniform1f(L.TIME,t*.001);gl.uniform1f(L.UW,uw?1:0); // draw solids then water
for(const [,c]of CH){if(c&&c.sb&&c.sc){bind(c.sb);gl.drawArrays(gl.TRIANGLES,0,c.sc)}}for(const [,c]of CH){if(c&&c.wb&&c.wc){bind(c.wb);gl.drawArrays(gl.TRIANGLES,0,c.wc)}}drawMini();requestAnimationFrame(step)}bootstrapBuild(3);requestAnimationFrame(step); /* ===== sanity (no asserts that halt) ===== */console.info('[Sanity] Program link:',gl.getProgramParameter(PG,gl.LINK_STATUS));/* ===== smoke tests: ensure look() ok ===== */try{const M=look([0,0,0],[0,0,-1],[0,1,0]);console.assert(M instanceof Float32Array && M.length===16,'[test] look() matrix shape');}catch(e){console.warn('[test] look() threw',e)}})();</script></html>
